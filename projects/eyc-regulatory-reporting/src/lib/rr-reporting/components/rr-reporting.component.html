<lib-dots-card [status]="status" (filingDetails)="receiveFilingDetails($event)"></lib-dots-card>
<lib-reporting-tabs-card (messageEvent)="receiveMessage($event)" [tabIn]="tabs"
    [dataExpPermission]="permissions.validatePermission('Reporting', 'Data Explorer')"></lib-reporting-tabs-card>
<div class="reporting-content-container">

    <motif-toast [type]="'success'" [show]="showToastAfterApproveExceptionReports"
        (close)="showToastAfterApproveExceptionReports = !showToastAfterApproveExceptionReports">Approved successfully
    </motif-toast>

    <motif-toast [type]="'success'" [show]="showToastAfterUnApproveFilings"
        (close)="showToastAfterUnApproveFilings = !showToastAfterUnApproveFilings">Unapproval
        successful!
    </motif-toast>

    <section id="exceptionReports" [hidden]="!(tabs==1)">
        <lib-shared-grid gridStyle="first" [columnDefs]="exceptionDefs" [rowData]="exceptionRowData"
            rowSelection="multiple" [submitFunction]="submitException" [modalMessage]="modalMessage"
            buttonPosition="left" [masterDetail]="true" [isToggle]="false" [modalConfig]="exceptionModalConfig"
            [permissionToPrimaryButton]="this.permissions.validatePermission('Reporting', 'Exception Status Change Resolve')"
            (selectedRowEmitter)="exceptionReportRowsSelected($event)" (toggleEventToParent)="onClickMyTask($event)" 
            [hideHeaderCheckbox]="(filingDetails.status[4].progress === 'COMPLETED' || filingDetails.status[4].progress === 'Completed')">
        </lib-shared-grid>

        <ng-template #commentExceptionTemplate let-row>
            <div *ngIf="row.comments!==0 && permissions.validatePermission('Reporting', 'View Comments')"
                class="comments-background" (click)="openComments(row)">
                {{row.comments}}
            </div>

            <div class="commentTemplate"
                *ngIf="(row.comments===0 || !row.comments) && permissions.validatePermission('Reporting', 'Add Comments') &&  
            !(filingDetails.status[4].progress === null || filingDetails.status[4].progress === 'COMPLETED' || filingDetails.status[4].progress === 'Completed')">
                <div class="add_icon">
                    <motif-icon [src]="'/assets/icons/editor/ic_mode_comment_24px.svg'"
                        (click)="addCommentToException(row)"><span class="plus">+</span></motif-icon>
                </div>
            </div>
        </ng-template>
        <ng-template #myTasksExceptionTemplate let-row>
            <div class="mytask" *ngIf="row.mytask">
                <motif-icon [src]="'/assets/icons/action/ic_assignment_24px.svg'"></motif-icon>
            </div>
        </ng-template>
        <ng-template #expandExceptionTemplate let-row>
            <div class="exceptionRouteCls" (click)="routeToExceptionDetailsPage(row)">{{ row.exceptionReportName}}</div>
        </ng-template>
        <ng-template #viewDetTemplate let-row>
            <div class="view-det-arrow">
                <motif-icon [src]="'/assets/icons/navigation/ic_chevron_right_24px.svg'"
                    (click)="routeToExceptionDetailsPage(row)"></motif-icon>
            </div>
        </ng-template>

    </section>

    <section id="filingEntities" [hidden]="!(tabs==2)" (click)="outsideClick($event)">
        <lib-shared-grid gridStyle="first" [columnDefs]="columnDefs" [rowData]="filingEntityRowData" rowSelection="multiple"
            [submitFunction]="submitEntities" [modalMessage]="modalMessage" buttonPosition="left" [masterDetail]="true"
            [isToggle]="false" [modalConfig]="filingModalConfig"
            [permissionToPrimaryButton]="this.permissions.validatePermission('Reporting', 'Filing Entity Status Change Resolve')"
            (selectedRowEmitter)="filingEnitiesRowsSelected($event)" (toggleEventToParent)="onClickMyTask($event)">
        </lib-shared-grid>
        <ng-template #headerTemplate>
            <div>
                <motif-icon [src]="'/assets/icons/hardware/ic_keyboard_arrow_down_24px.svg'" id="motifExampleDropdown"
                    tabindex="0"></motif-icon>
            </div>
        </ng-template>
        <ng-template #dropdownTemplate let-row>
            <div class="dropdownTemplate">
                <motif-icon class="complete" *ngIf="row.approved == true"
                    [src]="'/assets/icons/action/ic_done_24px.svg'"></motif-icon>
            </div>
        </ng-template>

        <ng-template #actionButtonTemplate let-row>
            <div class="actionButtonTemplate">
                <motif-icon *ngIf='tabs==2' [src]="'/assets/icons/navigation/ic_more_vert_24px.svg'" tabindex="0"
                    (click)="actionMenuEnableforEntity(row)" [ngClass]="row.approved ? 'actionCursor' : ''">
                </motif-icon>
                <motif-icon *ngIf='tabs==1' [src]="'/assets/icons/navigation/ic_more_vert_24px.svg'" tabindex="0"
                    (click)="actionMenuEnableforException(row)" [ngClass]="row.approved ? 'actionCursor' : ''">
                </motif-icon>
                <div #actionMenuTemp *ngIf='tabs==2'>
                    <motif-card class="action-menu-card"
                        *ngIf="actionMenuModal && selectedEntityId == row.entityId && row.approved">
                        <div *ngIf="this.permissions.validatePermission('Reporting', 'Filing Entity Unapprove') && !(filingDetails.status[4].progress === null || filingDetails.status[4].progress === 'COMPLETED' || filingDetails.status[4].progress === 'Completed')"
                            (click)="unApproveEntity()" class="action-mode">
                            <motif-icon [src]="'/assets/icons/content/ic_undo_24px.svg'"></motif-icon>
                            <span>Unapprove</span>
                        </div>
                    </motif-card>
                </div>
                <div #actionMenuTemp *ngIf='tabs==1'>
                    <motif-card class="action-menu-card"
                        *ngIf="actionMenuModal && selectedExceptionId == row.exceptionId && row.approved">
                        <div *ngIf="this.permissions.validatePermission('Reporting', 'Exception Unapprove') && !(filingDetails.status[4].progress === null || filingDetails.status[4].progress === 'COMPLETED' || filingDetails.status[4].progress === 'Completed')"
                            (click)="unApproveException()" class="action-mode">
                            <motif-icon [src]="'/assets/icons/content/ic_undo_24px.svg'"></motif-icon>
                            <span>Unapprove</span>
                        </div>
                    </motif-card>
                </div>
            </div>
        </ng-template>

        <ng-template #commentTemplate let-row>
            <div *ngIf="row.commentsCount!==0 && permissions.validatePermission('Reporting', 'View Comments')"
                class="comments-background" (click)="openComments(row)">
                {{row.commentsCount}}
            </div>
            <div class="commentTemplate"
                *ngIf="(row.commentsCount===0 || !row.commentsCount) && permissions.validatePermission('Reporting', 'Add Comments') && !(filingDetails.status[4].progress === null || filingDetails.status[4].progress === 'COMPLETED' || filingDetails.status[4].progress === 'Completed')">
                <div class="add_icon">
                    <motif-icon [src]="'/assets/icons/editor/ic_mode_comment_24px.svg'" (click)="addComment(row)"><span
                            class="plus">+</span></motif-icon>
                </div>
            </div>
        </ng-template>

        <ng-template #expandEntityTemplate let-row>
            <div class="exceptionRouteCls" (click)="routeToFilingEntityExceptionPage(row)">{{ row.entityName}}</div>
        </ng-template>

        <ng-template #viewFilingEntityTemplate let-row>
            <div class="view-det-arrow">
                <motif-icon [src]="'/assets/icons/navigation/ic_chevron_right_24px.svg'"
                    (click)="routeToFilingEntityExceptionPage(row)"></motif-icon>
            </div>
        </ng-template>

        <motif-toast [type]="'success'" [show]="showToastAfterApproveFilingEntities"
            (close)="showToastAfterApproveFilingEntities = !showToastAfterApproveFilingEntities">Approved successfully
        </motif-toast>
    </section>
</div>

<lib-comment-side-menu [(show)]="showComments" [entityId]="entityId" [entityType]="commentEntityType"
    [filingName]="commentsName" [permissionToAddComment]="permissions.validatePermission('Reporting', 'Add Comments')"
    [filingStatus]="(filingDetails.status[4].progress === null || filingDetails.status[4].progress === 'COMPLETED' || filingDetails.status[4].progress === 'Completed')"
    (commentAddedEmitter)="commentAdded()"></lib-comment-side-menu>