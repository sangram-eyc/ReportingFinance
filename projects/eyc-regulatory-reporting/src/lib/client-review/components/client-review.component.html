<lib-dots-card [status]="status" (filingDetails)="receiveFilingDetails($event)"></lib-dots-card>
<lib-reporting-tabs-card (messageEvent)="receiveMessage($event)"  [tabIn]="tabs" [dataExpPermission]="permissions.validatePermission('Client Review', 'Data Explorer')"></lib-reporting-tabs-card>
<div class="review-content-container">

    <motif-toast [type]="'success'" [show]="showToastAfterApproveExceptionReports"
    (close)="showToastAfterApproveExceptionReports = !showToastAfterApproveExceptionReports">Approved successfully
    </motif-toast>

    <section id="exceptionReports" [hidden]="!(tabs==1)">
        <lib-shared-grid 
            gridStyle="first"
            [columnDefs]="exceptionDefs" 
            [rowData]="exceptionData" 
            rowSelection="multiple" 
            [submitFunction]="submitException" 
            [modalMessage]="modalMessage" 
            buttonPosition="left" 
            [masterDetail]="true"
            [isToggle]= "false"
            [modalConfig]="exceptionModalConfig"
            [detailCellRendererParams]="exceptionDetailCellRendererParams"
            [defaultColDef]="exceptionDefaultColDef"
            (toggleEventToParent) = "onClickMyTask($event)"
            [permissionToPrimaryButton]="this.permissions.validatePermission('Client Review', 'Exception Status Change Resolve')"
            (selectedRowEmitter)="exceptionReportRowsSelected($event)"
        ></lib-shared-grid>
        
        
        <ng-template #commentExceptionTemplate let-row>
            <div *ngIf="row.comments!==0 && permissions.validatePermission('Client Review', 'View Comments')" class="comments-background" (click)="openComments(row)">
                {{row.comments}}
            </div>
            <div class="commentTemplate" *ngIf="(row.comments===0 || !row.comments) &&  permissions.validatePermission('Client Review', 'Add Comments')">
                <div class="add_icon">
                    <motif-icon [src]="'/assets/icons/editor/ic_mode_comment_24px.svg'" (click)="addCommentToException(row)"><span class="plus">+</span></motif-icon>
                </div>
            </div>
        </ng-template>
        <ng-template #myTasksExceptionTemplate let-row>
            <div class="mytask" *ngIf="row.mytask">
                <motif-icon [src]="'/assets/icons/action/ic_assignment_24px.svg'"></motif-icon>
            </div>
        </ng-template>
        <ng-template #expandExceptionTemplate let-row>
            <div class="exceptionRouteCls" (click)="routeToExceptionDetailsPage(row)">{{ row.exceptionReportName}}</div>
            </ng-template>
            <ng-template #viewDetTemplate let-row>
                <div>
                    <motif-icon [src]="'/assets/icons/navigation/ic_chevron_right_24px.svg'" (click)="routeToExceptionDetailsPage(row)"></motif-icon>
                </div>
            </ng-template>
    </section>

    <section id="filingEntities" [hidden]="!(tabs==2)">
        <div class="approve-button">
            <button *ngIf="permissions.validatePermission('Client Review', 'Filing Entity Status Change Resolve')" motifButton color="primary" size="large" (click)="approveFilingEntitiesModal = true;"
                [disabled]="selectedRows.length==0">Approve selected</button>
        </div>
            <motif-table [columnDefs]="columnDefs" [rowData]="rowData" [defaultColDef]="{
        headerCheckboxSelection: isFirstColumn,
        checkboxSelection: isFirstColumn
        }" rowSelection="multiple" (gridReady)="handleGridReady($event)" [firstColumnBorderRight]="true"
                [suppressRowClickSelection]="true" [suppressCellSelection]="true" [pagination]="false" paginationPageSize="10"
                (rowSelected)="onRowSelected($event)"></motif-table>
        <ng-template #headerTemplate>
            <div>
                <motif-icon [src]="'/assets/icons/hardware/ic_keyboard_arrow_down_24px.svg'" id="motifExampleDropdown"
                    tabindex="0"></motif-icon>
            </div>
        </ng-template>
        <ng-template #dropdownTemplate let-row>
            <div class="dropdownTemplate">
                <motif-icon class="complete" *ngIf="row.approved == true"
                    [src]="'/assets/icons/action/ic_done_24px.svg'"></motif-icon>
                <motif-icon [src]="'/assets/icons/navigation/ic_more_vert_24px.svg'" id="motifExampleDropdown1"
                    tabindex="0">
                </motif-icon>
            </div>
        </ng-template>
        
        <ng-template #commentTemplate let-row>
            <div *ngIf="row.commentsCount!==0 && permissions.validatePermission('Client Review', 'View Comments')" class="comments-background" (click)="openComments(row)">
                {{row.commentsCount}}
            </div>
            <div class="commentTemplate" *ngIf="(row.commentsCount===0 || !row.commentsCount) && permissions.validatePermission('Client Review', 'Add Comments')">
                <div class="add_icon">
                    <motif-icon [src]="'/assets/icons/editor/ic_mode_comment_24px.svg'" (click)="addComment(row)"><span class="plus">+</span></motif-icon>
                </div>
            </div>
        </ng-template>
        
        <motif-modal [show]="approveFilingEntitiesModal" (close)="approveFilingEntitiesModal = false">
            <motif-modal-header>
                Approve Selected
            </motif-modal-header>
            <motif-modal-body>
                <p>
                    Are you sure you want to approve the selected entities? This will approve them for submission.
                </p>
            </motif-modal-body>
            <motif-modal-footer>
                <button motifButton class="approve-yes" color="primary"
                    (click)="onSubmitApproveFilingEntities()">Yes</button>
                <button motifButton class="approve-no" color="secondary"
                    (click)="approveFilingEntitiesModal = false">No</button>
            </motif-modal-footer>
        </motif-modal>
        <motif-toast [type]="'success'" [show]="showToastAfterApproveFilingEntities"
            (close)="showToastAfterApproveFilingEntities = !showToastAfterApproveFilingEntities">Approved successfully
        </motif-toast>
    </section>
</div>

<lib-comment-side-menu [(show)]="showComments" [entityId]="entityId" [entityType]="commentEntityType" [filingName]="commentsName" [permissionToAddComment]="permissions.validatePermission('Client Review', 'Add Comments')" (commentAddedEmitter)="commentAdded()"></lib-comment-side-menu>