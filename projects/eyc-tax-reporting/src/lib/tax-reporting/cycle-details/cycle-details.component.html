<div class="production-cycle-details-wrapper">

  <div class="back-wrapper">
    <motif-icon class="back-button" [src]="'/assets/icons/hardware/ic_keyboard_backspace_24px.svg'"
      (click)="backtoCycleView()"></motif-icon>
    &nbsp;<span class="back-opt">&nbsp;Tax Reporting&nbsp;&nbsp;>&nbsp;&nbsp;<span
        style="font-weight: 400;">{{productCycleName}}</span></span>
  </div>

  <div class="production-cycle-details-header">
    <h1>{{pageName}}</h1>
  </div>

  <!--  <lib-shared-grid [columnDefs]="columnDefs" [rowData]="rowData" [paginationSize]="currentlySelectedPageSize.value"
    [pagination]="true" gridStyle="first" buttonPosition="left" [displayCheckBox]="true" [button]="false">
  </lib-shared-grid> -->

  <lib-shared-grid gridStyle="first" [columnDefs]="columnDefs" [rowData]="rowData" rowSelection="multiple"
    [submitFunction]="submitDatasets" buttonPosition="left" [masterDetail]="false" [modalConfig]="datasetsModalConfig"
    [detailCellRendererParams]="exceptionDetailCellRendererParams"
    (selectedRowEmitter)="datasetsReportRowsSelected($event)" [displaySecondButton]="true"
    [permissionToPrimaryButton]="true" [permissionToSecondaryButton]="false">
  </lib-shared-grid>

  <ng-template #datasetsDropdownTemplate let-row>

    <div class="complete" *ngIf="row.approvedBack === true">
      <motif-icon [src]="'/assets/eyc-tax-reporting/icons/ic-approved-entity.svg'">
        <!-- /assets/icons/action/ic_done_24px.svg -->
      </motif-icon>
    </div>

    <div class="complete" *ngIf="row.approvedBack === false && (row.openCommentsEY > 0 || row.openCommentsClient > 0)">
      <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect y="0.5" width="18" height="18" fill="#C4C4CD"/>
        </svg>
    </div>

    <div class="complete" *ngIf="!permissionApproval && (row.approvedBack === false && (row.openCommentsEY < 1 && row.openCommentsClient < 1))">
      <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect y="0.5" width="18" height="18" fill="#C4C4CD"/>
        </svg>
    </div>

  </ng-template>

  <ng-template #fundName let-row>
    <div *ngIf="row.assignedTo.length > 0" class="margin-tooltip-v2 mt-2">
      <motif-tooltip placement="bottom">
        <div motifTooltipTrigger aria-label="tooltip" class="dropdownTemplate">
          <motif-icon [src]="'/assets/icons/navigation/ic_more_vert_24px.svg'" id="motifExampleDropdown1" tabindex="0">
          </motif-icon>
        </div>
        <div (click)="addUsersToFund(row.id)" *ngIf="permissions.validatePermission('Production Cycles', 'Update assignment')" class="row row-assignm">
          <div class="col-md-4 col-sm-4 div-icon">
            <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M16 2H11.82C11.4 0.84 10.3 0 9 0C7.7 0 6.6 0.84 6.18 2H2C0.9 2 0 2.9 0 4V18C0 19.1 0.9 20 2 20H16C17.1 20 18 19.1 18 18V4C18 2.9 17.1 2 16 2ZM9 2C9.55 2 10 2.45 10 3C10 3.55 9.55 4 9 4C8.45 4 8 3.55 8 3C8 2.45 8.45 2 9 2ZM9 6C10.66 6 12 7.34 12 9C12 10.66 10.66 12 9 12C7.34 12 6 10.66 6 9C6 7.34 7.34 6 9 6ZM15 18H3V16.6C3 14.6 7 13.5 9 13.5C11 13.5 15 14.6 15 16.6V18Z"
                fill="#747480" />
            </svg>
          </div>
          <div class="col-md-8 col-sm-8 div-msg">
            <p class="text-tooltip">Update assignment</p>
          </div>
        </div>

        <div  *ngIf="!permissions.validatePermission('Production Cycles', 'Update assignment')" class="row row-assignm">
          <div class="col-md-4 col-sm-4 div-icon">
            <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M16 2H11.82C11.4 0.84 10.3 0 9 0C7.7 0 6.6 0.84 6.18 2H2C0.9 2 0 2.9 0 4V18C0 19.1 0.9 20 2 20H16C17.1 20 18 19.1 18 18V4C18 2.9 17.1 2 16 2ZM9 2C9.55 2 10 2.45 10 3C10 3.55 9.55 4 9 4C8.45 4 8 3.55 8 3C8 2.45 8.45 2 9 2ZM9 6C10.66 6 12 7.34 12 9C12 10.66 10.66 12 9 12C7.34 12 6 10.66 6 9C6 7.34 7.34 6 9 6ZM15 18H3V16.6C3 14.6 7 13.5 9 13.5C11 13.5 15 14.6 15 16.6V18Z"
                fill="#C4C4CD" />
            </svg>
          </div>
          <div class="col-md-8 col-sm-8 div-msg">
            <p class="text-tooltip" style="color:#C4C4CD;">Update assignment</p>
          </div>
        </div>
      </motif-tooltip>
    </div>

    <div *ngIf="row.assignedTo.length == 0" class="margin-tooltip-v2 mt-2 dropdownTemplate" style="width: 1.5rem;">
      <motif-icon [src]="'/assets/icons/navigation/ic_more_vert_24px.svg'" id="motifExampleDropdown1" tabindex="0">
      </motif-icon>
    </div>

    <span class="fund-name mt-2">{{row.name}}</span>
  </ng-template>

  <ng-template #urlDownload let-row>
    <div class="ml-4 grid-actions">
       <a *ngIf="row.hasContent" (click)="getDownloadFile(row)">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1"
          x="0px" y="0px" viewBox="0 0 480 480" style="enable-background:new 0 0 480 480;" xml:space="preserve"
          stroke="darkblue" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="darkblue">
          <path
            d="M378.528,214.688l-21.088-24c-5.824-6.624-15.904-7.264-22.56-1.472L272,244.32V16c0-8.832-7.168-16-16-16h-32 c-8.832,0-16,7.168-16,16v228.32l-62.88-55.104c-6.624-5.792-16.704-5.152-22.56,1.472l-21.088,23.968 c-5.856,6.656-5.184,16.8,1.472,22.624l126.528,110.752c6.048,5.28,15.04,5.28,21.088,0L377.056,237.28 C383.712,231.456,384.384,221.312,378.528,214.688z" />
          <path
            d="M416,416H64c-8.832,0-16,7.168-16,16v32c0,8.832,7.168,16,16,16h352c8.832,0,16-7.168,16-16v-32 C432,423.168,424.832,416,416,416z" />
        </svg>
      </a> 

      <a *ngIf="!row.hasContent">
        <svg  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1"
          x="0px" y="0px" viewBox="0 0 480 480" style="enable-background:new 0 0 480 480;" xml:space="preserve"
          stroke="darkblue" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#C4C4CD"  style="fill:#C4C4CD !important;cursor:auto;">
          <path
            d="M378.528,214.688l-21.088-24c-5.824-6.624-15.904-7.264-22.56-1.472L272,244.32V16c0-8.832-7.168-16-16-16h-32 c-8.832,0-16,7.168-16,16v228.32l-62.88-55.104c-6.624-5.792-16.704-5.152-22.56,1.472l-21.088,23.968 c-5.856,6.656-5.184,16.8,1.472,22.624l126.528,110.752c6.048,5.28,15.04,5.28,21.088,0L377.056,237.28 C383.712,231.456,384.384,221.312,378.528,214.688z" />
          <path
            d="M416,416H64c-8.832,0-16,7.168-16,16v32c0,8.832,7.168,16,16,16h352c8.832,0,16-7.168,16-16v-32 C432,423.168,424.832,416,416,416z" />
        </svg>
      </a>

      <a (click)="createComment(row)" *ngIf="permissions.validatePermission('Production Cycles', 'View comments')" >
        <svg width="22" height="23" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21.8228 2.83317C21.8228 1.6415 20.8587 0.666504 19.667 0.666504H2.33366C1.14199 0.666504 0.166992 1.6415 0.166992 2.83317V15.8332C0.166992 17.0248 1.14199 17.9998 2.33366 17.9998H17.5003L21.8337 22.3332L21.8228 2.83317ZM19.667 2.83317V17.1007L18.3995 15.8332H2.33366V2.83317H19.667ZM4.50033 11.4998H17.5003V13.6665H4.50033V11.4998ZM4.50033 8.24984H17.5003V10.4165H4.50033V8.24984ZM4.50033 4.99984H17.5003V7.1665H4.50033V4.99984Z" fill="#2E2E38"/>
        </svg>          
      </a>

      <a *ngIf="!permissions.validatePermission('Production Cycles', 'View comments')" > 
        <svg width="22" height="23" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21.8228 2.83317C21.8228 1.6415 20.8587 0.666504 19.667 0.666504H2.33366C1.14199 0.666504 0.166992 1.6415 0.166992 2.83317V15.8332C0.166992 17.0248 1.14199 17.9998 2.33366 17.9998H17.5003L21.8337 22.3332L21.8228 2.83317ZM19.667 2.83317V17.1007L18.3995 15.8332H2.33366V2.83317H19.667ZM4.50033 11.4998H17.5003V13.6665H4.50033V11.4998ZM4.50033 8.24984H17.5003V10.4165H4.50033V8.24984ZM4.50033 4.99984H17.5003V7.1665H4.50033V4.99984Z" fill="#C4C4CD"/>
        </svg>                   
      </a>
  
    </div>
  </ng-template>

  <ng-template #openCommentEY let-row>
    <button (click)="createComment(row)" class='counter-item' [ngClass]="row.openCommentsEY > 0 ? 'has-count': 'zero-count'" color="primary">
      {{row.openCommentsEY}}
    </button>
  </ng-template>

  <ng-template #openCommentClient let-row>
    <button (click)="createComment(row)" class='counter-item' [ngClass]="row.openCommentsClient > 0 ? 'has-count': 'zero-count'" color="primary">
      {{row.openCommentsClient}}
    </button>
  </ng-template>

  <ng-template #assignedToTemplate let-row>
    <div class="comment-user mt-2" *ngFor="let user of row.assignedTo; let i = index">
      <div class="header-avatar" *ngIf="i < 2">
        <motif-avatar [userName]="user.userFirstName +' '+ user.userLastName" status="none"></motif-avatar>
      </div>
    </div>

    <div class="margin-tooltip mt-2" *ngIf="row.assignedTo.length > 1">
      <motif-tooltip placement="bottom">
        <h4 motifTooltipTrigger aria-label="tooltip" class="link-assigned"><b
            *ngIf="row.assignedTo.length > 2">+{{row.assignedTo.length-2}}</b></h4>
        <div *ngFor="let item of row.assignedTo; let x = index">
          <span *ngIf="x > 1">{{item.userFirstName + " " + item.userLastName}}</span>
        </div>
      </motif-tooltip>
    </div>

    <a class="cursor-pointer" *ngIf="(permissions.validatePermission('Production Cycles', 'Add assignment')) && (row.assignedTo.length == 0)" (click)="addUsersToFund(row.id)">
      <svg width="24" height="14" viewBox="0 0 24 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M8 5.5H5V2.5H3V5.5H0V7.5H3V10.5H5V7.5H8V5.5ZM18 6.5C19.66 6.5 20.99 5.16 20.99 3.5C20.99 1.84 19.66 0.5 18 0.5C17.68 0.5 17.37 0.55 17.09 0.64C17.66 1.45 17.99 2.43 17.99 3.5C17.99 4.57 17.65 5.54 17.09 6.36C17.37 6.45 17.68 6.5 18 6.5ZM13 6.5C14.66 6.5 15.99 5.16 15.99 3.5C15.99 1.84 14.66 0.5 13 0.5C11.34 0.5 10 1.84 10 3.5C10 5.16 11.34 6.5 13 6.5ZM19.62 8.66C20.45 9.39 21 10.32 21 11.5V13.5H24V11.5C24 9.96 21.63 9.01 19.62 8.66ZM13 8.5C11 8.5 7 9.5 7 11.5V13.5H19V11.5C19 9.5 15 8.5 13 8.5Z"
          fill="#155CB4" />
      </svg>
    </a>

    <a class="cursor-pointer" *ngIf="!(permissions.validatePermission('Production Cycles', 'Add assignment')) && (row.assignedTo.length == 0)">
      <svg width="24" height="14" viewBox="0 0 24 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M8 5.5H5V2.5H3V5.5H0V7.5H3V10.5H5V7.5H8V5.5ZM18 6.5C19.66 6.5 20.99 5.16 20.99 3.5C20.99 1.84 19.66 0.5 18 0.5C17.68 0.5 17.37 0.55 17.09 0.64C17.66 1.45 17.99 2.43 17.99 3.5C17.99 4.57 17.65 5.54 17.09 6.36C17.37 6.45 17.68 6.5 18 6.5ZM13 6.5C14.66 6.5 15.99 5.16 15.99 3.5C15.99 1.84 14.66 0.5 13 0.5C11.34 0.5 10 1.84 10 3.5C10 5.16 11.34 6.5 13 6.5ZM19.62 8.66C20.45 9.39 21 10.32 21 11.5V13.5H24V11.5C24 9.96 21.63 9.01 19.62 8.66ZM13 8.5C11 8.5 7 9.5 7 11.5V13.5H19V11.5C19 9.5 15 8.5 13 8.5Z"
          fill="#C4C4CD" />
      </svg>
    </a>


  </ng-template>
</div>